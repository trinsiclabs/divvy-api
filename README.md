# Divvy API

RESTful service which connects the client app to the network.

There are three core functions the service provides:

1. Identity generation
2. Querying the ledger
3. Updating the ledger

## Identity generation and wallets

In order to query or update the ledger, the user needs a private / public
key pair, generated by their organisations CA. Each users key pair is
stored in their organisations wallet. Wallets don't store tokens
of any sort, the only store identities.

## Getting started

The API component is started automatically with the network. If you want to
mess around with the API and make calls into the network without going
through the client app, read on...

The API component uses a custom Docker image which needs to be built.
If you haven't built the image already:

```
$ docker build -t trinsiclabs/divvy-api .
```

Once the image is built, you can bring up the API container:

```
$ docker-compose up -d
```

This will install the required JavaScript dependencies and start the service.

Admin identities are generated automatically when organisations are created,
so you can probably skip this step. But if you're doing something weird, you
might need to create one or regenerate an existing one:

```
$ docker exec api.divvy.com node ./lib/security.js enrolladmin <org>
```

Generate a user identity:

```
$ docker exec api.divvy.com node ./lib/security.js registeruser <org> <user>
```

Query the ledger:

```
$ docker exec api.divvy.com node ./lib/query.js \
    -o <org> \
    -u <user> \
    -c <org>-channel \
    -n share \
    -m queryShare \
    -a '["<org>","1"]'
```
